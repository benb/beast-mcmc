<?xml version="1.0" standalone="yes"?>
<!--
  ~ testRandomLocalClock.xml
  ~
  ~ Copyright (C) 2002-2009 Alexei Drummond and Andrew Rambaut
  ~
  ~ This file is part of BEAST.
  ~ See the NOTICE file distributed with this work for additional
  ~ information regarding copyright ownership and licensing.
  ~
  ~ BEAST is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU Lesser General Public License as
  ~ published by the Free Software Foundation; either version 2
  ~ of the License, or (at your option) any later version.
  ~
  ~ BEAST is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Lesser General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Lesser General Public
  ~ License along with BEAST; if not, write to the
  ~ Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
  ~ Boston, MA  02110-1301  USA
  -->

<!-- Generated by BEAUTi v1.5a1                                              -->
<!--       by Alexei J. Drummond and Andrew Rambaut                          -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       http://beast.bio.ed.ac.uk/                                        -->
<beast>

    <!-- The list of taxa analyse (can also include dates/ages).                 -->
    <!-- ntax=6                                                                  -->
    <taxa id="taxa">
        <taxon id="human"/>
        <taxon id="chimp"/>
        <taxon id="bonobo"/>
        <taxon id="gorilla"/>
        <taxon id="orangutan"/>
        <taxon id="siamang"/>
    </taxa>

    <!-- The sequence alignment (each sequence refers to a taxon above).         -->
    <!-- ntax=6 nchar=768                                                        -->
    <alignment id="alignment" dataType="nucleotide">
        <sequence>
            <taxon idref="human"/>
            AGAAATATGTCTGATAAAAGAGTTACTTTGATAGAGTAAATAATAGGAGCTTAAACCCCCTTATTTCTACTAGGACTATGAGAATCGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCGTACTAAGAAATTTAGGTTAAATACAGACCAAGAGCCTTCAAAGCCCTCAGTAAGTTG-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGACCAATGGGACTTAAACCCACAAACACTTAGTTAACAGCTAAGCACCCTAATCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAA-TCACCTCGGAGCTTGGTAAAAAGAGGCCTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCCAAAGCTGGTTTCAAGCCAACCCCATGGCCTCCATGACTTTTTCAAAAGGTATTAGAAAAACCATTTCATAACTTTGTCAAAGTTAAATTATAGGCT-AAATCCTATATATCTTA-CACTGTAAAGCTAACTTAGCATTAACCTTTTAAGTTAAAGATTAAGAGAACCAACACCTCTTTACAGTGA
        </sequence>
        <sequence>
            <taxon idref="chimp"/>
            AGAAATATGTCTGATAAAAGAATTACTTTGATAGAGTAAATAATAGGAGTTCAAATCCCCTTATTTCTACTAGGACTATAAGAATCGAACTCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTACACCCTTCCCGTACTAAGAAATTTAGGTTAAGCACAGACCAAGAGCCTTCAAAGCCCTCAGCAAGTTA-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATTAATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAATCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAA-TCACCTCAGAGCTTGGTAAAAAGAGGCTTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCTAAAGCTGGTTTCAAGCCAACCCCATGACCTCCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATTACAGGTT-AACCCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGATTAAGAGGACCGACACCTCTTTACAGTGA
        </sequence>
        <sequence>
            <taxon idref="bonobo"/>
            AGAAATATGTCTGATAAAAGAATTACTTTGATAGAGTAAATAATAGGAGTTTAAATCCCCTTATTTCTACTAGGACTATGAGAGTCGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCGTACTAAGAAATTTAGGTTAAACACAGACCAAGAGCCTTCAAAGCTCTCAGTAAGTTA-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATTAATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAATCAGC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTTGAATTTGCAATTCAATATGAAAA-TCACCTCAGAGCTTGGTAAAAAGAGGCTTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCTAAAGCTGGTTTCAAGCCAACCCCATGACCCCCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATTACAGGTT-AAACCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGATTAAGAGGACCAACACCTCTTTACAGTGA
        </sequence>
        <sequence>
            <taxon idref="gorilla"/>
            AGAAATATGTCTGATAAAAGAGTTACTTTGATAGAGTAAATAATAGAGGTTTAAACCCCCTTATTTCTACTAGGACTATGAGAATTGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTGTCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTCACATCCTTCCCGTACTAAGAAATTTAGGTTAAACATAGACCAAGAGCCTTCAAAGCCCTTAGTAAGTTA-CAACACTTAATTTCTGTAAGGACTGCAAAACCCTACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATCAATGGGACTCAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAGTCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAT-TCACCTCGGAGCTTGGTAAAAAGAGGCCCAGCCTCTGTCTTTAGATTTACAGTCCAATGCCTTA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCCAAAGCTGGTTTCAAGCCAACCCCATGACCTTCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAGGTTAAATTACGGGTT-AAACCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCGTTAACCTTTTAAGTTAAAGATTAAGAGTATCGGCACCTCTTTGCAGTGA
        </sequence>
        <sequence>
            <taxon idref="orangutan"/>
            AGAAATATGTCTGACAAAAGAGTTACTTTGATAGAGTAAAAAATAGAGGTCTAAATCCCCTTATTTCTACTAGGACTATGGGAATTGAACCCACCCCTGAGAATCCAAAATTCTCCGTGCCACCCATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTACACCCTTCCCGTACTAAGAAATTTAGGTTA--CACAGACCAAGAGCCTTCAAAGCCCTCAGCAAGTCA-CAGCACTTAATTTCTGTAAGGACTGCAAAACCCCACTTTGCATCAACTGAGCGCAAATCAGCCACTTTAATTAAGCTAAGCCCTCCTAGACCGATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAGTCAAT-TGGCTTCAGTCCAAAGCCCCGGCAGGCCTTAAAGCTGCTCCTTCGAATTTGCAATTCAACATGACAA-TCACCTCAGGGCTTGGTAAAAAGAGGTCTGACCCCTGTTCTTAGATTTACAGCCTAATGCCTTAACTCGGCCATTTTACCGCAAAAAAGGAAGGAATCGAACCTCCTAAAGCTGGTTTCAAGCCAACCCCATAACCCCCATGACTTTTTCAAAAGGTACTAGAAAAACCATTTCGTAACTTTGTCAAAGTTAAATTACAGGTC-AGACCCTGTGTATCTTA-CATTGCAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGACTAAGAGAACCAGCCTCTCTTTGCAATGA
        </sequence>
        <sequence>
            <taxon idref="siamang"/>
            AGAAATACGTCTGACGAAAGAGTTACTTTGATAGAGTAAATAACAGGGGTTTAAATCCCCTTATTTCTACTAGAACCATAGGAGTCGAACCCATCCTTGAGAATCCAAAACTCTCCGTGCCACCCGTCGCACCCTGTTCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCATACTAAGAAATTTAGGTTAAACACAGACCAAGAGCCTTCAAAGCCCTCAGTAAGTTAACAAAACTTAATTTCTGCAAGGGCTGCAAAACCCTACTTTGCATCAACCGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATCGATGGGACTTAAACCCATAAAAATTTAGTTAACAGCTAAACACCCTAAACAACCTGGCTTCAATCTAAAGCCCCGGCAGA-GTTGAAGCTGCTTCTTTGAACTTGCAATTCAACGTGAAAAATCACTTCGGAGCTTGGCAAAAAGAGGTTTCACCTCTGTCCTTAGATTTACAGTCTAATGCTTTA-CTCAGCCACTTTACCACAAAAAAGGAAGGAATCGAACCCTCTAAAACCGGTTTCAAGCCAGCCCCATAACCTTTATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATCACAGGTCCAAACCCCGTATATCTTATCACTGTAGAGCTAGACCAGCATTAACCTTTTAAGTTAAAGACTAAGAGAACTACCGCCTCTTTACAGTGA
        </sequence>
    </alignment>

    <!-- The unique patterns for all positions                                   -->
    <!-- npatterns=69                                                            -->
    <patterns id="patterns" from="1">
        <alignment idref="alignment"/>
    </patterns>

    <!-- A prior assumption that the population size has remained constant       -->
    <!-- throughout the time spanned by the genealogy.                           -->
    <constantSize id="constant" units="substitutions">
        <populationSize>
            <parameter id="constant.popSize" value="0.077" lower="0.0" upper="Infinity"/>
        </populationSize>
    </constantSize>

    <!-- Generate a random starting tree under the coalescent process            -->
    <coalescentTree id="startingTree">
        <taxa idref="taxa"/>
        <constantSize idref="constant"/>
    </coalescentTree>

    <treeModel id="treeModel">
        <coalescentTree idref="startingTree"/>
        <rootHeight>
            <parameter id="treeModel.rootHeight"/>
        </rootHeight>
        <nodeHeights internalNodes="true">
            <parameter id="treeModel.internalNodeHeights"/>
        </nodeHeights>
        <nodeHeights internalNodes="true" rootNode="true">
            <parameter id="treeModel.allInternalNodeHeights"/>
        </nodeHeights>
    </treeModel>

    <coalescentLikelihood id="coalescent">
        <model>
            <constantSize idref="constant"/>
        </model>
        <populationTree>
            <treeModel idref="treeModel"/>
        </populationTree>
    </coalescentLikelihood>

    <!-- The random local clock model (Drummond & Suchard, 2007)                 -->
    <randomLocalClockModel id="branchRates" ratesAreMultipliers="false">
        <treeModel idref="treeModel"/>
        <rates>
            <parameter id="localClock.rates"/>
        </rates>
        <rateIndicator>
            <parameter id="localClock.changes"/>
        </rateIndicator>
        <clockRate>
            <parameter id="clock.rate" value="1.0"/>
        </clockRate>
    </randomLocalClockModel>

    <sumStatistic id="rateChanges" name="rateChangeCount" elementwise="true">
        <parameter idref="localClock.changes"/>
    </sumStatistic>

    <rateStatistic id="meanRate" name="meanRate" mode="mean" internal="true" external="true">
        <treeModel idref="treeModel"/>
        <randomLocalClockModel idref="branchRates"/>
    </rateStatistic>

    <rateStatistic id="coefficientOfVariation" name="coefficientOfVariation" mode="coefficientOfVariation"
                   internal="true" external="true">
        <treeModel idref="treeModel"/>
        <randomLocalClockModel idref="branchRates"/>
    </rateStatistic>

    <rateCovarianceStatistic id="covariance" name="covariance">
        <treeModel idref="treeModel"/>
        <randomLocalClockModel idref="branchRates"/>
    </rateCovarianceStatistic>

    <!-- The HKY substitution model (Hasegawa, Kishino & Yano, 1985)             -->
    <hkyModel id="hky">
        <frequencies>
            <frequencyModel dataType="nucleotide">
                <alignment idref="alignment"/>
                <frequencies>
                    <parameter id="hky.frequencies" dimension="4"/>
                </frequencies>
            </frequencyModel>
        </frequencies>
        <kappa>
            <parameter id="hky.kappa" value="1.0" lower="0.0" upper="Infinity"/>
        </kappa>
    </hkyModel>

    <!-- site model                                                              -->
    <siteModel id="siteModel">
        <substitutionModel>
            <hkyModel idref="hky"/>
        </substitutionModel>
    </siteModel>

    <treeLikelihood id="treeLikelihood">
        <patterns idref="patterns"/>
        <treeModel idref="treeModel"/>
        <siteModel idref="siteModel"/>
        <randomLocalClockModel idref="branchRates"/>
    </treeLikelihood>

    <operators id="operators">
        <scaleOperator scaleFactor="0.75" weight="1.0">
            <parameter idref="hky.kappa"/>
        </scaleOperator>
        <scaleOperator scaleFactor="0.75" weight="15.0">
            <parameter idref="localClock.rates"/>
        </scaleOperator>
        <bitFlipOperator weight="15.0">
            <parameter idref="localClock.changes"/>
        </bitFlipOperator>
        <scaleOperator scaleFactor="0.75" weight="3.0">
            <parameter idref="constant.popSize"/>
        </scaleOperator>
        <scaleOperator scaleFactor="0.75" weight="3.0">
            <parameter idref="treeModel.rootHeight"/>
        </scaleOperator>
        <uniformOperator weight="30.0">
            <parameter idref="treeModel.internalNodeHeights"/>
        </uniformOperator>
        <subtreeSlide size="0.0077" gaussian="true" weight="15.0">
            <treeModel idref="treeModel"/>
        </subtreeSlide>
        <narrowExchange weight="15.0">
            <treeModel idref="treeModel"/>
        </narrowExchange>
        <wideExchange weight="3.0">
            <treeModel idref="treeModel"/>
        </wideExchange>
        <wilsonBalding weight="3.0">
            <treeModel idref="treeModel"/>
        </wilsonBalding>
    </operators>

    <mcmc id="mcmc" chainLength="10000000" autoOptimize="true">
        <posterior id="posterior">
            <prior id="prior">
                <jeffreysPrior>
                    <parameter idref="hky.kappa"/>
                </jeffreysPrior>
                <jeffreysPrior>
                    <parameter idref="constant.popSize"/>
                </jeffreysPrior>
                <gammaPrior shape="0.5" scale="2.0" offset="0.0">
                    <parameter idref="localClock.rates"/>
                </gammaPrior>
                <poissonPrior mean="1.0" offset="0.0">
                    <sumStatistic idref="rateChanges"/>
                </poissonPrior>
                <coalescentLikelihood idref="coalescent"/>
            </prior>
            <likelihood id="likelihood">
                <treeLikelihood idref="treeLikelihood"/>
            </likelihood>
        </posterior>
        <operators idref="operators"/>
        <log id="screenLog" logEvery="10000">
            <column label="Posterior" dp="4" width="12">
                <posterior idref="posterior"/>
            </column>
            <column label="Prior" dp="4" width="12">
                <prior idref="prior"/>
            </column>
            <column label="Likelihood" dp="4" width="12">
                <likelihood idref="likelihood"/>
            </column>
            <column label="Root Height" sf="6" width="12">
                <parameter idref="treeModel.rootHeight"/>
            </column>
            <column label="Rate" sf="6" width="12">
                <rateStatistic idref="meanRate"/>
            </column>
            <column label="Rate Changes" dp="0" width="12">
                <sumStatistic idref="rateChanges"/>
            </column>
        </log>
        <log id="fileLog" logEvery="1000" fileName="testRandomLocalClock.log">
            <posterior idref="posterior"/>
            <prior idref="prior"/>
            <likelihood idref="likelihood"/>
            <rateStatistic idref="meanRate"/>
            <parameter idref="treeModel.rootHeight"/>
            <parameter idref="constant.popSize"/>
            <parameter idref="hky.kappa"/>
            <rateStatistic idref="coefficientOfVariation"/>
            <rateCovarianceStatistic idref="covariance"/>
            <sumStatistic idref="rateChanges"/>
            <treeLikelihood idref="treeLikelihood"/>
            <coalescentLikelihood idref="coalescent"/>
        </log>
        <logTree id="treeFileLog" logEvery="1000" nexusFormat="true" fileName="testRandomLocalClock.trees"
                 sortTranslationTable="true">
            <treeModel idref="treeModel"/>
            <randomLocalClockModel idref="branchRates"/>
            <posterior idref="posterior"/>
        </logTree>
    </mcmc>


    <!--

    Analysing log file: testRandomLocalClock.log  (seed=666)

    Time taken : 11.28 minutes

    burnIn   = -1
    maxState = 10000000

    statistic                mean          hpdLower      hpdUpper      ESS
    posterior                -1818.26      -1828.74      -1806.76      1464.04
    prior                    -2.70143      -13.0917      7.5181        1357.47
    likelihood               -1815.56      -1819.06      -1812.7       8968.7
    meanRate                 1             1.0           1.0           8759.02
    treeModel.rootHeight     6.363E-2      4.91872E-2    7.80912E-2    3528.28
    constant.popSize         9.67405E-2    2.72573E-2    0.19992       8129.66
    hky.kappa                30.0394       14.7267       48.8503       6876.13
    coefficientOfVariation   7.02408E-2    0             0.34575       1926.39
    covariance               0.47952       0.875         0.875         ?
    rateChangeCount          0.40786       0             2             4627.43
    treeLikelihood           -1815.56      -1819.06      -1812.7       8968.7
    coalescent               7.29521       5.38376       8.95753       5627.92

    -->

    <traceAnalysis fileName="testRandomLocalClock.log">
        <expectation name="posterior" value="-1818.26"/>
        <expectation name="prior" value="-2.70143"/>
        <expectation name="likelihood" value="-1815.56"/>
        <expectation name="treeModel.rootHeight" value="6.363E-2"/>
        <expectation name="constant.popSize" value="9.67405E-2"/>
        <expectation name="hky.kappa" value="30.0394"/>
        <expectation name="coefficientOfVariation" value="7.02408E-2"/>
        <expectation name="rateChangeCount" value="0.40786"/>
        <expectation name="coalescent" value="7.29521"/>
    </traceAnalysis>


    <report>
        <property name="timer">
            <object idref="mcmc"/>
        </property>
    </report>

</beast>
