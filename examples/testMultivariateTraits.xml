<?xml version="1.0" standalone="yes"?>
<beast>

	<taxa id="taxa">
		<taxon id="A">
			<attr name="trait">1.0 2.0</attr>
		</taxon>
		<taxon id="B">
			<attr name="trait">NA 4.0</attr>
		</taxon>
		<taxon id="C">
			<attr name="trait">0.0 0.0</attr>
		</taxon>
	</taxa>

	<constantSize id="initialTreePop" units="substitutions">
		<populationSize>
			<parameter value="10.0"/>
		</populationSize>
	</constantSize>

	<newick id="startingTree">
		((A:0.5,B:0.5):0.5,C:1.0);
	</newick>

	<treeModel id="treeModel">
		<coalescentTree idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
		<nodeTraits rootNode="false" internalNodes="false" leafNodes="true" traitDimension="2">
			<parameter id="leafTraits"/>
		</nodeTraits>
		<nodeTraits rootNode="true" internalNodes="true" leafNodes="true" traitDimension="2">
			<parameter id="allTraits"/>
		</nodeTraits>
		<nodeTraits rootNode="true" internalNodes="true" leafNodes="false" traitDimension="2">
			<parameter id="internalTraits"/>
		</nodeTraits>
		<nodeTraits rootNode="true" internalNodes="false" leafNodes="false" traitDimension="2">
			<parameter id="rootTrait"/>
		</nodeTraits>
	</treeModel>

	<multivariateNormalPrior id="rootPrior">
		<mean>
			<parameter value="0.0 0.0"/>
		</mean>
		<precision>
			<matrixParameter>
				<parameter value="10.0 2.5"/>
				<parameter value="2.5 5.0"/>
			</matrixParameter>
		</precision>
		<data>
			<parameter idref="rootTrait"/>
		</data>
	</multivariateNormalPrior>

	<multivariateDiffusionModel id="diffusionModel">
		<precisionMatrix>
			<matrixParameter id="precisionMatrix">
				<parameter id="col1" value="5.0 1.5"/>
				<parameter id="col2" value="1.5 2.0"/>
			</matrixParameter>
		</precisionMatrix>
	</multivariateDiffusionModel>

	<multivariateWishartPrior id="precisionPrior" df="3">
		<scaleMatrix>
			<matrixParameter>
				<parameter value="5.0 1.5"/>
				<parameter value="1.5 2.0"/>
			</matrixParameter>
		</scaleMatrix>
		<data>
			<matrixParameter idref="precisionMatrix"/>
		</data>
	</multivariateWishartPrior>

	<multivariateTraitLikelihood id="traitLikelihood" traitName="trait">
		<multivariateDiffusionModel idref="diffusionModel"/>
		<treeModel idref="treeModel"/>
		<traitParameter>
			<parameter idref="leafTraits"/>
		</traitParameter>
		<missingIndicator>
			<parameter id="missingTraitValues"/>
		</missingIndicator>
	</multivariateTraitLikelihood>

	<operators id="operators">
		<randomWalkOperator windowSize="1.0" weight="10">
			<parameter idref="internalTraits"/>
		</randomWalkOperator>

		<randomWalkOperator windowSize="1.0" weight="3">
			<parameter idref="leafTraits"/>
			<updateIndex>
				<parameter idref="missingTraitValues"/>
			</updateIndex>
		</randomWalkOperator>

		<precisionGibbsOperator weight="1">
			<treeModel idref="treeModel"/>
			<matrixParameter idref="precisionMatrix"/>
			<multivariateWishartPrior idref="precisionPrior"/>
		</precisionGibbsOperator>

		<internalTraitGibbsOperator weight="1">
			<treeModel idref="treeModel"/>
			<multivariateDiffusionModel idref="diffusionModel"/>
		</internalTraitGibbsOperator>
	</operators>

	<mcmc id="mcmc" chainLength="10000" autoOptimize="true">
		<posterior id="posterior">
			<likelihood id="likelihood">
				<multivariateTraitLikelihood idref="traitLikelihood"/>
			</likelihood>
			<prior>
				<multivariateNormalPrior idref="rootPrior"/>
			</prior>
		</posterior>
		<operators idref="operators"/>
		<log id="fileLog" logEvery="10" fileName="testMultivariateTraits.log">
			<matrixParameter idref="precisionMatrix"/>
			<parameter idref="allTraits"/>
		</log>
	</mcmc>

	<traceAnalysis fileName="testMultivariateTraits.log"/>

</beast>
