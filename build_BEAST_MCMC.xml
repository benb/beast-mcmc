<!-- Build BEAST MCMC. It is also used by Hudson BEAST_MCMC project. JUnit test is available for this build. -->
<project basedir="." default="build_all_BEAST" name="BUILD_BEAST_MCMC">
	<description>
		Build BEAST MCMC. It is also used by Hudson BEAST_MCMC project. JUnit test is available for this build.
	    $Id: build_BEAST_MCMC.xml,v 1.0 2009/04/15 Walter Xie Exp $
	</description>

	<!-- set global properties for this build -->
	<property name="src" location="src" />
	<property name="build" location="bin" />
	<property name="lib" location="lib" />
	<property name="dist" location="bin/dist" />
	
	<property name="main_class_BEAST" value="dr.app.beast.BeastMain" />
	<property name="main_class_BEAUTI" value="dr.app.beauti.BeautiApp" />
	
	<property environment="env" />

	<target name="init">
		<echo message="${ant.project.name}: ${ant.file}" />
	</target>

	<target name="clean">
		<delete dir="bin" />
	</target>
	
	<target name="build_all_BEAST" depends="clean,compile-all"
        description="Clean and Build all run-time stuff">
	</target>
	
	<target name="build_jar_all_BEAST" depends="clean,compile-all,dist_all_BEAST"
        description="Clean and Build all run-time stuff">
	</target>

	<target name="compile-all" depends="init">
		<mkdir dir="${build}" />
		
		<!-- Compile the java code from ${src} into ${build} /bin -->
		<javac source="1.5" srcdir="${src}" destdir="${build}" 
			 classpath="${lib}/jebl.jar:${lib}/jdom.jar:${lib}/beagle.jar:${lib}/commons-math-1.2.jar:
						${lib}/mtj.jar:${lib}/colt.jar:${lib}/itext-1.4.5.jar:${lib}/junit-4.4.jar:
						${lib}/JRI.jar:${lib}/mpj.jar">
			<include name="dr/app/beast/**" />
			<include name="dr/app/beauti/**" />
			<include name="dr/app/oldbeauti/**" />
			<include name="dr/app/seqgen/**" />
			<include name="dr/app/tools/**" />
			<include name="dr/app/util/**" />
			<include name="dr/evolution/**" />
			<include name="dr/evomodel/**" />
			<include name="dr/evomodelxml/**" />
			<include name="dr/evoxml/**" />
			<include name="dr/exporters/**" />
			<include name="dr/gui/chart/**" />
			<include name="dr/gui/tree/**" />
			<include name="dr/inference/**" />
			<include name="dr/math/**" />
			<include name="dr/matrix/**" />
			<include name="dr/stats/**" />
			<include name="dr/util/**" />
			<include name="dr/xml/**" />
			<include name="org/virion/jam/**" />
		</javac>
	</target>

	<target name="dist_all_BEAST" depends="compile-all" description="create BEAST + BEAUTI jar">
		<!-- Create the distribution directory -->
		<mkdir dir="${dist}" />

		<!-- Put everything in ${build} into the beast.jar file -->
		<jar jarfile="${dist}/beast.jar">
			<manifest>
				<attribute name="Built-By" value="${user.name}" />
				<attribute name="Main-Class" value="${main_class_BEAST}" />
			</manifest>
			<fileset dir="${build}">
				<include name="dr/app/beast/**/*.class" />
				<!--<include name="dr/app/beastdev/**/*.class"/>-->
				<include name="dr/app/beauti/**/*.class" />
				<include name="dr/app/seqgen/**" />
				<include name="dr/app/util/**/*.class" />
				<include name="dr/app/tools/**/*.class" />
				<include name="dr/evolution/**/*.class" />
				<include name="dr/evomodel/**/*.class" />
				<include name="dr/evoxml/**/*.class" />
				<include name="dr/evomodelxml/**" />
				<include name="dr/exporters/**/*.class" />
				<include name="dr/gui/tree/**/*.class" />
				<include name="dr/inference/**/*.class" />
				<include name="dr/math/**/*.class" />
				<include name="dr/matrix/**/*.class" />
				<include name="dr/stats/**/*.class" />
				<include name="dr/util/**/*.class" />
				<include name="dr/xml/**/*.class" />
				<include name="org/virion/jam/**/*.class" />
			</fileset>
			<fileset dir="">
				<include name="images/*.png" />
			</fileset>
			<fileset dir="${src}">
				<include name="dr/**/*.png" />
				<include name="org/virion/jam/**/*.png" />
				<include name="dr/**/*.properties" />
			</fileset>
			<zipgroupfileset dir="${lib}" includes="jebl.jar" />
			<zipgroupfileset dir="${lib}" includes="jdom.jar" />
			<zipgroupfileset dir="${lib}" includes="beagle.jar" />
			<zipgroupfileset dir="${lib}" includes="commons-math-1.2.jar" />
			<zipgroupfileset dir="${lib}" includes="mtj.jar" />
			<zipgroupfileset dir="${lib}" includes="JRI.jar" />
			<zipgroupfileset dir="${lib}" includes="colt.jar" />
		</jar>

		<!-- Put everything in ${build} into the beauti.jar file -->
		<jar jarfile="${dist}/beauti.jar">
			<manifest>
				<attribute name="Built-By" value="${user.name}" />
				<attribute name="Main-Class" value="${main_class_BEAUTI}" />
			</manifest>
			<fileset dir="${build}">
				<include name="dr/app/beast/BeastVersion.class" />
				<include name="dr/app/beauti/**/*.class" />
				<include name="dr/app/oldbeauti/**/*.class" />
				<include name="dr/app/util/**/*.class" />
				<include name="dr/evolution/alignment/**/*.class" />
				<include name="dr/evolution/coalescent/**/*.class" />
				<include name="dr/evolution/colouring/**/*.class" />
				<include name="dr/evolution/datatype/**/*.class" />
				<include name="dr/evolution/distance/**/*.class" />
				<include name="dr/evolution/io/**/*.class" />
				<include name="dr/evolution/parsimony/**/*.class" />
				<include name="dr/evolution/sequence/**/*.class" />
				<include name="dr/evolution/tree/**/*.class" />
				<include name="dr/evolution/util/**/*.class" />
				<include name="dr/evomodel/branchratemodel/**/*.class" />
				<include name="dr/evomodel/clock/**/*.class" />
				<include name="dr/evomodel/coalescent/**/*.class" />
				<include name="dr/evomodel/indel/**/*.class" />
				<include name="dr/evomodel/operators/**/*.class" />
				<include name="dr/evomodel/sitemodel/**/*.class" />
				<include name="dr/evomodel/speciation/**/*.class" />
				<include name="dr/evomodel/substmodel/**/*.class" />
				<include name="dr/evomodel/tree/**/*.class" />
				<include name="dr/evomodel/treelikelihood/**/*.class" />
				<include name="dr/evomodelxml/**/*.class" />
				<include name="dr/evoxml/**/*.class" />
				<include name="dr/gui/chart/**" />
				<include name="dr/gui/table/**" />
				<include name="dr/gui/tree/**" />
				<include name="dr/inference/**/*.class" />
				<include name="dr/math/**/*.class" />
				<include name="dr/matrix/**/*.class" />
				<include name="dr/stats/**/*.class" />
				<include name="dr/util/**/*.class" />
				<include name="dr/xml/**/*.class" />
				<include name="org/virion/jam/**/*.class" />
			</fileset>
			<fileset dir="">
				<include name="images/*.png" />
			</fileset>
			<fileset dir="${src}">
				<include name="dr/**/*.png" />
				<include name="org/virion/jam/**/*.png" />
			</fileset>
			<zipgroupfileset dir="${lib}" includes="jebl.jar" />
			<zipgroupfileset dir="${lib}" includes="jdom.jar" />
			<zipgroupfileset dir="${lib}" includes="commons-math-1.2.jar" />
			<zipgroupfileset dir="${lib}" includes="mtj.jar" />
		</jar>
	</target>
	
	<target name="run_BEAST">
		<java jar="${dist}/beast.jar" fork="true" />
	</target>
	
	<target name="run_BEAUTI">
		<java jar="${dist}/beauti.jar" fork="true" />
	</target>
</project>
